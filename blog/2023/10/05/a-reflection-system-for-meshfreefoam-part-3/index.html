<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.117.0"><meta name=robots content="index, follow"><link rel="shortcut icon" href=/MeshFreeFoam-Docs/favicons/favicon.ico><link rel=apple-touch-icon href=/MeshFreeFoam-Docs/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/MeshFreeFoam-Docs/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/MeshFreeFoam-Docs/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/MeshFreeFoam-Docs/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/MeshFreeFoam-Docs/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/MeshFreeFoam-Docs/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/MeshFreeFoam-Docs/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/MeshFreeFoam-Docs/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/MeshFreeFoam-Docs/favicons/android-192x192.png sizes=192x192><title>A reflection system for MeshFreeFoam: Part 3 | MeshFreeFoam API Docs</title><meta name=description content="Finalized description of the reflection system for schema generation
"><meta property="og:title" content="A reflection system for MeshFreeFoam: Part 3"><meta property="og:description" content="Finalized description of the reflection system for schema generation
"><meta property="og:type" content="article"><meta property="og:url" content="https://foamscience.github.io/MeshFreeFoam-Docs/blog/2023/10/05/a-reflection-system-for-meshfreefoam-part-3/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2023-10-05T00:00:00+00:00"><meta property="article:modified_time" content="2023-10-08T16:08:55+02:00"><meta property="og:site_name" content="API docs for MeshFreeFoam"><meta itemprop=name content="A reflection system for MeshFreeFoam: Part 3"><meta itemprop=description content="Finalized description of the reflection system for schema generation
"><meta itemprop=datePublished content="2023-10-05T00:00:00+00:00"><meta itemprop=dateModified content="2023-10-08T16:08:55+02:00"><meta itemprop=wordCount content="1561"><meta itemprop=keywords content="c++,quality-of-life,gui,openfoam,"><meta name=twitter:card content="summary"><meta name=twitter:title content="A reflection system for MeshFreeFoam: Part 3"><meta name=twitter:description content="Finalized description of the reflection system for schema generation
"><link rel=preload href=/MeshFreeFoam-Docs/scss/main.min.82405bd70688c051c67c90adc004e04dfb6e0d6e3662ea9ed492379d237d683c.css as=style><link href=/MeshFreeFoam-Docs/scss/main.min.82405bd70688c051c67c90adc004e04dfb6e0d6e3662ea9ed492379d237d683c.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.6.3.min.js integrity="sha512-STof4xm1wgkfm7heWqFJVn58Hm3EtS31XFaagaa8VMReCXAkQnJZ+jEy8PCC/iT18dFy95WcExNHFTqLyp72eQ==" crossorigin=anonymous></script>
<script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script>
<link rel=stylesheet href=/MeshFreeFoam-Docs/css/prism.css><script async src="https://www.googletagmanager.com/gtag/js?id=UA-00000000-0"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-00000000-0")}</script></head><body class="td-page td-blog"><header><nav class="td-navbar navbar-dark js-navbar-scroll"><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/MeshFreeFoam-Docs/><span class="navbar-brand__logo navbar-logo"></span><span class=navbar-brand__name>MeshFreeFoam API Docs</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/MeshFreeFoam-Docs/about/><span>About</span></a></li><li class=nav-item><a class=nav-link href=/MeshFreeFoam-Docs/docs/><span>Docs</span></a></li><li class=nav-item><a class=nav-link href=/MeshFreeFoam-Docs/api/><span>MeshFreeFoam API</span></a></li><li class=nav-item><a class=nav-link href=/MeshFreeFoam-Docs/tests/><span>Unit Tests</span></a></li><li class=nav-item><a class="nav-link active" href=/MeshFreeFoam-Docs/blog/><span>Blog</span></a></li></ul></div><div class="d-none d-lg-block"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/MeshFreeFoam-Docs/offline-search-index.2869fb56695ec41d5a92963525235df2.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/MeshFreeFoam-Docs/offline-search-index.2869fb56695ec41d5a92963525235df2.json data-offline-search-base-href=/ data-offline-search-max-results=10></div><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ms-3 fas fa-bars" type=button data-bs-toggle=collapse data-bs-target=#td-section-nav aria-controls=td-section-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="collapse td-sidebar-nav foldable-nav" id=td-section-nav><ul class="td-sidebar-nav__section pe-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-meshfreefoam-docsblog-li><a href=/MeshFreeFoam-Docs/blog/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-meshfreefoam-docsblog><span>Blog</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-meshfreefoam-docsblogdiscussions-li><input type=checkbox id=m-meshfreefoam-docsblogdiscussions-check checked>
<label for=m-meshfreefoam-docsblogdiscussions-check><a href=/MeshFreeFoam-Docs/blog/discussions/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-meshfreefoam-docsblogdiscussions><span>Discussions</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-meshfreefoam-docsblog20230818the-very-first-issues-i-ran-into-with-this-documentation-project-li><input type=checkbox id=m-meshfreefoam-docsblog20230818the-very-first-issues-i-ran-into-with-this-documentation-project-check>
<label for=m-meshfreefoam-docsblog20230818the-very-first-issues-i-ran-into-with-this-documentation-project-check><a href=/MeshFreeFoam-Docs/blog/2023/08/18/the-very-first-issues-i-ran-into-with-this-documentation-project/ title="The very first issues I ran into with this documentation project" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-meshfreefoam-docsblog20230818the-very-first-issues-i-ran-into-with-this-documentation-project><span>First Issues</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-meshfreefoam-docsblog20230818managing-dependency-software-for-meshfreefoam-li><input type=checkbox id=m-meshfreefoam-docsblog20230818managing-dependency-software-for-meshfreefoam-check>
<label for=m-meshfreefoam-docsblog20230818managing-dependency-software-for-meshfreefoam-check><a href=/MeshFreeFoam-Docs/blog/2023/08/18/managing-dependency-software-for-meshfreefoam/ title="Managing dependency software for `meshfreeFoam`" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-meshfreefoam-docsblog20230818managing-dependency-software-for-meshfreefoam><span>meshfreeFoam dependencies</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-meshfreefoam-docsblog20230823design-of-domain-shapes-li><input type=checkbox id=m-meshfreefoam-docsblog20230823design-of-domain-shapes-check>
<label for=m-meshfreefoam-docsblog20230823design-of-domain-shapes-check><a href=/MeshFreeFoam-Docs/blog/2023/08/23/design-of-domain-shapes/ title="Design of domain shapes" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-meshfreefoam-docsblog20230823design-of-domain-shapes><span>Domain shapes</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-meshfreefoam-docsblog20230828runtime-selection-mechanism-for-meshfreefoam-li><input type=checkbox id=m-meshfreefoam-docsblog20230828runtime-selection-mechanism-for-meshfreefoam-check>
<label for=m-meshfreefoam-docsblog20230828runtime-selection-mechanism-for-meshfreefoam-check><a href=/MeshFreeFoam-Docs/blog/2023/08/28/runtime-selection-mechanism-for-meshfreefoam/ title="Runtime selection mechanism for `MeshFreeFoam`" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-meshfreefoam-docsblog20230828runtime-selection-mechanism-for-meshfreefoam><span>Runtime selection</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-meshfreefoam-docsblog20230829introducing-unit-tests-with-foamut-li><input type=checkbox id=m-meshfreefoam-docsblog20230829introducing-unit-tests-with-foamut-check>
<label for=m-meshfreefoam-docsblog20230829introducing-unit-tests-with-foamut-check><a href=/MeshFreeFoam-Docs/blog/2023/08/29/introducing-unit-tests-with-foamut/ title="Introducing unit tests with foamUT" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-meshfreefoam-docsblog20230829introducing-unit-tests-with-foamut><span>FoamUT Unit tests</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-meshfreefoam-docsblog20230829optimization-notes-part-1-li><input type=checkbox id=m-meshfreefoam-docsblog20230829optimization-notes-part-1-check>
<label for=m-meshfreefoam-docsblog20230829optimization-notes-part-1-check><a href=/MeshFreeFoam-Docs/blog/2023/08/29/optimization-notes-part-1/ title="Optimization notes: Part 1" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-meshfreefoam-docsblog20230829optimization-notes-part-1><span>Optimization notes 1</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-meshfreefoam-docsblog20230927lazy-evaluation-part-1-li><input type=checkbox id=m-meshfreefoam-docsblog20230927lazy-evaluation-part-1-check>
<label for=m-meshfreefoam-docsblog20230927lazy-evaluation-part-1-check><a href=/MeshFreeFoam-Docs/blog/2023/09/27/lazy-evaluation-part-1/ title="Lazy Evaluation: Part 1" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-meshfreefoam-docsblog20230927lazy-evaluation-part-1><span>Lazy evaluation 1</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-meshfreefoam-docsblog20230929a-reflection-system-for-meshfreefoam-part-1-li><input type=checkbox id=m-meshfreefoam-docsblog20230929a-reflection-system-for-meshfreefoam-part-1-check>
<label for=m-meshfreefoam-docsblog20230929a-reflection-system-for-meshfreefoam-part-1-check><a href=/MeshFreeFoam-Docs/blog/2023/09/29/a-reflection-system-for-meshfreefoam-part-1/ title="A reflection system for MeshFreeFoam: Part 1" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-meshfreefoam-docsblog20230929a-reflection-system-for-meshfreefoam-part-1><span>Reflections for MeshFreeFoam 1</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-meshfreefoam-docsblog20231002a-reflection-system-for-meshfreefoam-part-2-li><input type=checkbox id=m-meshfreefoam-docsblog20231002a-reflection-system-for-meshfreefoam-part-2-check>
<label for=m-meshfreefoam-docsblog20231002a-reflection-system-for-meshfreefoam-part-2-check><a href=/MeshFreeFoam-Docs/blog/2023/10/02/a-reflection-system-for-meshfreefoam-part-2/ title="A reflection system for MeshFreeFoam: Part 2" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-meshfreefoam-docsblog20231002a-reflection-system-for-meshfreefoam-part-2><span>Reflections for MeshFreeFoam 2</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-meshfreefoam-docsblog20231005a-reflection-system-for-meshfreefoam-part-3-li><input type=checkbox id=m-meshfreefoam-docsblog20231005a-reflection-system-for-meshfreefoam-part-3-check checked>
<label for=m-meshfreefoam-docsblog20231005a-reflection-system-for-meshfreefoam-part-3-check><a href=/MeshFreeFoam-Docs/blog/2023/10/05/a-reflection-system-for-meshfreefoam-part-3/ title="A reflection system for MeshFreeFoam: Part 3" class="align-left ps-0 active td-sidebar-link td-sidebar-link__page" id=m-meshfreefoam-docsblog20231005a-reflection-system-for-meshfreefoam-part-3><span class=td-sidebar-nav-active-item>Reflections for MeshFreeFoam 3</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-meshfreefoam-docsblognews-li><input type=checkbox id=m-meshfreefoam-docsblognews-check>
<label for=m-meshfreefoam-docsblognews-check><a href=/MeshFreeFoam-Docs/blog/news/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-meshfreefoam-docsblognews><span>News</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-meshfreefoam-docsblog20230819easy-api-documentation-with-hugo-and-hyde-li><input type=checkbox id=m-meshfreefoam-docsblog20230819easy-api-documentation-with-hugo-and-hyde-check>
<label for=m-meshfreefoam-docsblog20230819easy-api-documentation-with-hugo-and-hyde-check><a href=/MeshFreeFoam-Docs/blog/2023/08/19/easy-api-documentation-with-hugo-and-hyde/ title="Easy API documentation with Hugo and Hyde" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-meshfreefoam-docsblog20230819easy-api-documentation-with-hugo-and-hyde><span>Announcing APIDocs</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-meshfreefoam-docsblogreleases-li><input type=checkbox id=m-meshfreefoam-docsblogreleases-check>
<label for=m-meshfreefoam-docsblogreleases-check><a href=/MeshFreeFoam-Docs/blog/releases/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-meshfreefoam-docsblogreleases><span>Releases</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-meshfreefoam-docsblog20230819no-releases-li><input type=checkbox id=m-meshfreefoam-docsblog20230819no-releases-check>
<label for=m-meshfreefoam-docsblog20230819no-releases-check><a href=/MeshFreeFoam-Docs/blog/2023/08/19/no-releases/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-meshfreefoam-docsblog20230819no-releases><span>No Releases?</span></a></label></li></ul></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ms-2 pb-1 pt-2 mb-0"><a href=https://github.com/FoamScience/MeshFreeFoam-Docs/tree/main/content/en/blog/discussions/010-reflections-part-3/index.md class=td-page-meta--view target=_blank rel=noopener><i class="fa-solid fa-file-lines fa-fw"></i> View page source</a>
<a href=https://github.com/FoamScience/MeshFreeFoam-Docs/edit/main/content/en/blog/discussions/010-reflections-part-3/index.md class=td-page-meta--edit target=_blank rel=noopener><i class="fa-solid fa-pen-to-square fa-fw"></i> Edit this page (not the frontmatter!)</a>
<a href="https://github.com/FoamScience/MeshFreeFoam-Docs/new/main/content/en/blog/discussions/010-reflections-part-3/index.md?filename=change-me.md&amp;value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" class=td-page-meta--child target=_blank rel=noopener><i class="fa-solid fa-pen-to-square fa-fw"></i> Create child page</a>
<a href="https://github.com/FoamScience/MeshFreeFoam-Docs/issues/new?title=A%20reflection%20system%20for%20MeshFreeFoam:%20Part%203" class=td-page-meta--issue target=_blank rel=noopener><i class="fa-solid fa-list-check fa-fw"></i> Create documentation issue</a>
<a href=https://github.com/FoamScience/MeshFreeFoam/issues/new class=td-page-meta--project-issue target=_blank rel=noopener><i class="fa-solid fa-list-check fa-fw"></i> Create project issue</a></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#make-classes-reflect-themselves>Make classes reflect themselves?</a></li><li><a href=#runtime-selection-to-the-rescue>Runtime selection to the rescue</a></li><li><a href=#a-recap-of-the-api-to-generate-model-schemas>A recap of the API to generate model schemas</a></li><li><a href=#going-the-extra-mile>Going the extra-mile</a><ul><li><a href=#defaulted-values-for-members>Defaulted values for members???</a></li><li><a href=#complete-nested-model-schemas>Complete nested model schemas???</a></li></ul></li><li><a href=#conclusion>Conclusion</a></li></ul></nav></div><div class="taxonomy taxonomy-terms-cloud taxo-tags"><h5 class=taxonomy-title>Tag Cloud</h5><ul class=taxonomy-terms><li><a class=taxonomy-term href=https://foamscience.github.io/MeshFreeFoam-Docs/tags/#nanoflannkdtreetests/ data-taxonomy-term=#nanoflannkdtreetests><span class=taxonomy-label>#nanoflannKDTreeTests</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://foamscience.github.io/MeshFreeFoam-Docs/tags/#trisurfaceshapetests/ data-taxonomy-term=#trisurfaceshapetests><span class=taxonomy-label>#triSurfaceShapeTests</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://foamscience.github.io/MeshFreeFoam-Docs/tags/advectiondiffusion/ data-taxonomy-term=advectiondiffusion><span class=taxonomy-label>advectionDiffusion</span><span class=taxonomy-count>2</span></a></li><li><a class=taxonomy-term href=https://foamscience.github.io/MeshFreeFoam-Docs/tags/c++/ data-taxonomy-term=c++><span class=taxonomy-label>c++</span><span class=taxonomy-count>10</span></a></li><li><a class=taxonomy-term href=https://foamscience.github.io/MeshFreeFoam-Docs/tags/dependency/ data-taxonomy-term=dependency><span class=taxonomy-label>dependency</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://foamscience.github.io/MeshFreeFoam-Docs/tags/docs/ data-taxonomy-term=docs><span class=taxonomy-label>docs</span><span class=taxonomy-count>2</span></a></li><li><a class=taxonomy-term href=https://foamscience.github.io/MeshFreeFoam-Docs/tags/documentation/ data-taxonomy-term=documentation><span class=taxonomy-label>documentation</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://foamscience.github.io/MeshFreeFoam-Docs/tags/git/ data-taxonomy-term=git><span class=taxonomy-label>git</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://foamscience.github.io/MeshFreeFoam-Docs/tags/gui/ data-taxonomy-term=gui><span class=taxonomy-label>gui</span><span class=taxonomy-count>3</span></a></li><li><a class=taxonomy-term href=https://foamscience.github.io/MeshFreeFoam-Docs/tags/hyde/ data-taxonomy-term=hyde><span class=taxonomy-label>hyde</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://foamscience.github.io/MeshFreeFoam-Docs/tags/meshfreefoam/ data-taxonomy-term=meshfreefoam><span class=taxonomy-label>meshfreeFoam</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://foamscience.github.io/MeshFreeFoam-Docs/tags/openfoam/ data-taxonomy-term=openfoam><span class=taxonomy-label>openfoam</span><span class=taxonomy-count>7</span></a></li><li><a class=taxonomy-term href=https://foamscience.github.io/MeshFreeFoam-Docs/tags/performance/ data-taxonomy-term=performance><span class=taxonomy-label>performance</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://foamscience.github.io/MeshFreeFoam-Docs/tags/quality-of-life/ data-taxonomy-term=quality-of-life><span class=taxonomy-label>quality-of-life</span><span class=taxonomy-count>3</span></a></li><li><a class=taxonomy-term href=https://foamscience.github.io/MeshFreeFoam-Docs/tags/sample/ data-taxonomy-term=sample><span class=taxonomy-label>sample</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://foamscience.github.io/MeshFreeFoam-Docs/tags/serial/ data-taxonomy-term=serial><span class=taxonomy-label>serial</span><span class=taxonomy-count>2</span></a></li></ul></div><div class="taxonomy taxonomy-terms-cloud taxo-categories"><h5 class=taxonomy-title>Categories</h5><ul class=taxonomy-terms><li><a class=taxonomy-term href=https://foamscience.github.io/MeshFreeFoam-Docs/categories/examples/ data-taxonomy-term=examples><span class=taxonomy-label>Examples</span><span class=taxonomy-count>2</span></a></li></ul></div><div class="taxonomy taxonomy-terms-cloud taxo-contributors"><h5 class=taxonomy-title>Contributors</h5><ul class=taxonomy-terms><li><a class=taxonomy-term href=https://foamscience.github.io/MeshFreeFoam-Docs/contributors/__missing__/ data-taxonomy-term=missing><span class=taxonomy-label>&lt;Missing></span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://foamscience.github.io/MeshFreeFoam-Docs/contributors/elwardi/ data-taxonomy-term=mohammed-elwardi-fadeli><span class=taxonomy-label>Mohammed Elwardi Fadeli</span><span class=taxonomy-count>6</span></a></li></ul></div><div class="taxonomy taxonomy-terms-cloud taxo-api_tags"><h5 class=taxonomy-title>API Tags</h5><ul class=taxonomy-terms><li><a class=taxonomy-term href=https://foamscience.github.io/MeshFreeFoam-Docs/api_tags/library/ data-taxonomy-term=library><span class=taxonomy-label>library</span><span class=taxonomy-count>1</span></a></li></ul></div></aside><main class="col-12 col-md-9 col-xl-8 ps-md-5 pe-md-4" role=main><a class=td-rss-button title=RSS href=https://foamscience.github.io/MeshFreeFoam-Docs/blog/discussions/index.xml target=_blank rel=noopener><i class="fa-solid fa-rss" aria-hidden=true></i></a><div class=td-content><h1>A reflection system for MeshFreeFoam: Part 3</h1><div class=lead>Finalized description of the reflection system for schema generation</div><div class="td-byline mb-4">By <b>Mohammed Elwardi Fadeli (<a href=https://www.linkedin.com/in/elwardi-fadeli>@elwardi</a>)</b> |
<time datetime=2023-10-05 class=text-muted>Thursday, October 05, 2023</time></div><header class=article-meta><div class="taxonomy taxonomy-terms-article taxo-tags"><h5 class=taxonomy-title>Tags:</h5><ul class=taxonomy-terms><li><a class=taxonomy-term href=https://foamscience.github.io/MeshFreeFoam-Docs/tags/c++/ data-taxonomy-term=c++><span class=taxonomy-label>c++</span></a></li><li><a class=taxonomy-term href=https://foamscience.github.io/MeshFreeFoam-Docs/tags/quality-of-life/ data-taxonomy-term=quality-of-life><span class=taxonomy-label>quality-of-life</span></a></li><li><a class=taxonomy-term href=https://foamscience.github.io/MeshFreeFoam-Docs/tags/gui/ data-taxonomy-term=gui><span class=taxonomy-label>gui</span></a></li><li><a class=taxonomy-term href=https://foamscience.github.io/MeshFreeFoam-Docs/tags/openfoam/ data-taxonomy-term=openfoam><span class=taxonomy-label>openfoam</span></a></li></ul></div><p class=reading-time><i class="fa-solid fa-clock" aria-hidden=true></i>&nbsp; 8 minute read &nbsp;</p></header><p>The <a href=/blog/2023/10/02/a-reflection-system-for-meshfreefoam-part-2/>previous post</a> outlined the main challenges in implementing a decent reflection system for OpenFOAM while preserving the benefits of the runtime selection mechanism.</p><p>In this post, I describe the final state of the system and its limitations, along with some implementation details.</p><h2 id=make-classes-reflect-themselves>Make classes reflect themselves?</h2><p>From the previous post, we have deduced that it is mainly possible to automatically generate a schema for a class. The only case where generating such a schema proves difficult is when nesting RTS models. So, let&rsquo;s explore how this issue can be resolved. Assume the following abstract base class, which has a few reflected members:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#579># These are only reflected members of baseModel, it can have non-reflected ones
</span></span></span><span style=display:flex><span><span style=color:#579></span>baseModel
</span></span><span style=display:flex><span><span style=color:#333>|--&gt;</span> key_ (autoPtr<span style=color:#333>&lt;</span>word<span style=color:#333>&gt;</span>)
</span></span><span style=display:flex><span><span style=color:#333>|--&gt;</span> m_   (label)
</span></span><span style=display:flex><span><span style=color:#333>|--&gt;</span> vv_  (Vector<span style=color:#333>&lt;</span>scalar<span style=color:#333>&gt;</span>)
</span></span></code></pre></div><p>For the sake of code maintainability, let&rsquo;s say that we have a static member of a template class <code>builder&lt;T>::schema()</code> which returns the following dictionary if executed with <code>[T = baseModel]</code> (note that the RTS mechanism is consulted for available model options):</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span>{
</span></span><span style=display:flex><span>    baseModelType   <span style=background-color:#fff0f0>&#34;__one of ( childModel childModel1 childModel2 )__&#34;</span>;
</span></span><span style=display:flex><span>    key                    <span style=background-color:#fff0f0>&#34;__optional Foam::word here__&#34;</span>;
</span></span><span style=display:flex><span>    m                      <span style=color:#00d;font-weight:700>0</span>;
</span></span><span style=display:flex><span>    vv                     ( <span style=color:#00d;font-weight:700>0</span> <span style=color:#00d;font-weight:700>0</span> <span style=color:#00d;font-weight:700>0</span> );
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Such schema is possible to achieve entirely because of the compile-time reflection system and C++ concepts. But notice that once a user chooses an implemented model, the schema will be missing the members from the chosen <code>childModel</code>.</p><p>A simple test of such schema methods:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#080;font-weight:700>constexpr</span> <span style=color:#339;font-weight:700>bool</span> hasSchema <span style=color:#333>=</span> SelfReflectableModel<span style=color:#333>&lt;</span>childModel<span style=color:#333>&gt;</span>;
</span></span><span style=display:flex><span><span style=color:#080;font-weight:700>if</span> <span style=color:#06b;font-weight:700>constexpr</span> (hasSchema) {
</span></span><span style=display:flex><span>    dict <span style=color:#333>=</span> schema<span style=color:#333>&lt;</span>childModel<span style=color:#333>&gt;</span>();
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>will result in the following schema:</p><pre tabindex=0><code>{
    baseModelType   childModel;
    type            ;
    subModel
    {
        baseModelType   &#34;__one of ( childModel childModel1 childModel2 )__&#34;;
        key             &#34;__optional Foam::word here__&#34;;
        m               0;
        vv              ( 0 0 0 );
    }
    key             &#34;__optional Foam::word here__&#34;;
    m               0;
    vv              ( 0 0 0 );
}
</code></pre><p>for a child type which has the following members (Both the nested RTS model <code>subModel_</code> and the <code>type_</code> member now show up in the schema):</p><pre tabindex=0><code>childModel : public baseModel
|--&gt; type_     (word)
|--&gt; subModel_ (autoPtr&lt;baseModel&gt;)
</code></pre><blockquote><p>From this experiment, we deduce that generating schemas for abstract base classes is way less important than for concrete implementations of the target models.</p></blockquote><p>Note that the previous C++ code snippet features <strong>compile-time if statements</strong> which execute the schema method only if the target type is self-reflectable (a fancy way to say: the type has a <code>schema</code> method). If it is not the case, the compiler generates no code. Hence, the runtime cost occurs only if the type is self-reflectable, in which case, an OpenFOAM dictionary is built from the target type&rsquo;s members.</p><p>In addition, concepts help generate code for specific cases. A good example is to fill the dictionary values with default-constructed values of the members only if the member type is default-constructible.</p><p>Special cases for some class members can be also treated. As an example, take a member which is an <code>autoPtr&lt;Something></code>. If the member points to a RTS-managed type (such us <code>baseModel</code>, <code>childModel</code>&mldr; etc), we will want to execute the schema function from that type. This is how the schema for the <code>childModel::subModel_</code> for example is generated while generating the schema for <code>childModel</code>.</p><p>In the case of the pointed-to member type is not RTS-managed (eg. a simple <code>word</code> as in <code>childModel::key_</code>), we can assume that it&rsquo;s an optional input and hint that assumption to the end user!</p><h2 id=runtime-selection-to-the-rescue>Runtime selection to the rescue</h2><p>Reflection is traditionally tailored towards POD ( plain-old-data, which define little behavior ) structures, and using it together with the runtime selection mechanism proves to be difficult. One of the main issues that we particularly need the classes to generate their schema on their own is that we don&rsquo;t want to include all headers in the application (include only those of the base classes), and allow users to dynamically load their libraries). One way of doing this would be to make the <code>schema</code> method an <strong>abstract method</strong> on base classes.</p><p>On the other hand, we need to generate a schema without creating any objects of the target type, so <code>schema</code> must also be <strong>static</strong>. Since there is no such thing as a <strong>static virtual method</strong>, we have to resolve this in another way.</p><p>These conflicting interests are the exact reason behind the runtime selection mechanism, so we can simply abuse to, instead of building a table of constructors, build a table of function points which points to a free method (or a static in a template class):</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#888>// The table of function pointers (for illustration purposes only, function pointers are not stored like this)
</span></span></span><span style=display:flex><span><span style=color:#888></span>(
</span></span><span style=display:flex><span>   childModel <span style=color:#333>&amp;</span>builder<span style=color:#333>&lt;</span>childModel<span style=color:#333>&gt;::</span>schema()
</span></span><span style=display:flex><span>   childModel1 <span style=color:#333>&amp;</span>builder<span style=color:#333>&lt;</span>childModel1<span style=color:#333>&gt;::</span>schema()
</span></span><span style=display:flex><span>   childModel2 <span style=color:#333>&amp;</span>builder<span style=color:#333>&lt;</span>childModel2<span style=color:#333>&gt;::</span>schema()
</span></span><span style=display:flex><span>)
</span></span></code></pre></div><p>Then we leverage the same mechanism <code>::New</code> uses to create objects by looking up the table for the model we want; and then call the function through the stored function pointer.</p><h2 id=a-recap-of-the-api-to-generate-model-schemas>A recap of the API to generate model schemas</h2><p>The base block for the whole mechanism would be a static member method to generate a schema for the target type <code>T</code>. This method has to have all desired features (eg. can call itself if a member of <code>T</code> is an <code>autoPtr&lt;U></code> if U is also an RTS-managed class):</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span>dictionary builder<span style=color:#333>&lt;</span>T<span style=color:#333>&gt;::</span>schema()
</span></span></code></pre></div><p>The next layer is a set of static members that need to be present on the base class. Basically, a hash table of regular function pointers, and a few methods to construct and destroy the table. A subclass to the base class is also need so we can use to add children to the table. All of this can be hidden behind a few macros easily.</p><p>Similarly to <code>::New()</code>, base classes then can have a <code>baseModel::schema(const word&)</code> static method which looks up the hash table for the passed-in model type name and calls the corresponding function.</p><p>The child classes will also have to initialize a static member for a specific type so they get added to the hash table automatically (static initialization happens before <code>main</code>).</p><p>Let&rsquo;s look at a full application example, which presents the user with available options for a <code>baseModel</code> and generates a schema for <strong>the chosen concrete implementation</strong>:</p><blockquote><p>Notice how there is no explicit mentioning of child classes.</p></blockquote><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#888>// OpenFOAM includes....
</span></span></span><span style=display:flex><span><span style=color:#888></span><span style=color:#579>#include</span> <span style=color:#579>&#34;baseModel.H&#34;</span><span style=color:#579>
</span></span></span><span style=display:flex><span><span style=color:#579></span><span style=color:#339;font-weight:700>int</span> <span style=color:#06b;font-weight:700>main</span>()
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    Info <span style=color:#333>&lt;&lt;</span> <span style=background-color:#fff0f0>&#34;Choose a Model from available baseModels:&#34;</span> <span style=color:#333>&lt;&lt;</span> endl;
</span></span><span style=display:flex><span>    Info <span style=color:#333>&lt;&lt;</span> mff<span style=color:#333>::</span>baseModel<span style=color:#333>::</span>schemasPtr_<span style=color:#333>-&gt;</span>toc() <span style=color:#333>&lt;&lt;</span> endl;
</span></span><span style=display:flex><span>    word modelType;
</span></span><span style=display:flex><span>    std<span style=color:#333>::</span>getline(std<span style=color:#333>::</span>cin, modelType);
</span></span><span style=display:flex><span>    Info <span style=color:#333>&lt;&lt;</span> <span style=background-color:#fff0f0>&#34;Here is how you&#39;re supposed to construct a &#34;</span> <span style=color:#333>&lt;&lt;</span> modelType <span style=color:#333>&lt;&lt;</span> endl;
</span></span><span style=display:flex><span>    Info <span style=color:#333>&lt;&lt;</span> mff<span style=color:#333>::</span>baseModel<span style=color:#333>::</span>schema(modelType) <span style=color:#333>&lt;&lt;</span> endl;
</span></span><span style=display:flex><span>    <span style=color:#080;font-weight:700>return</span> <span style=color:#00d;font-weight:700>0</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><pre tabindex=0><code>{
    baseModelType   childModel;
    type            ;
    subModel
    {
        baseModelType   &#34;__one of ( childModel childModel1 childModel2 )__&#34;;
        key             &#34;__optional Foam::word here__&#34;;
        m               0;
        vv              ( 0 0 0 );
    }
    key             &#34;__optional Foam::word here__&#34;;
    m               0;
    vv              ( 0 0 0 );
}
</code></pre><p><strong>Beautiful!</strong> 🎉 🥳</p><h2 id=going-the-extra-mile>Going the extra-mile</h2><p>There a couple of loose ends to tie up:</p><h3 id=defaulted-values-for-members>Defaulted values for members???</h3><p>As it stands now, the schemas will suggest default values for members as in &ldquo;default values for C++ types&rdquo;. It would be interesting if we could extract the actual default values of the members as used in the target&rsquo;s type construction (They properly have more physical meaning)!</p><p>This turns out not be so easy. One idea that comes to mind is to first create a schema for the target type ignoring all optional members; then use that schema to actually create an object of the target type. From there, it only remains to check the values of the optional members.</p><p>But this is not possible since objects can be created from all kinds of objects (and not just from a dictionary) and restricting that doesn&rsquo;t look like a good idea.</p><p>To achieve this effect, we would have to use complex members holding their metadata; such as:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#080;font-weight:700>class</span> <span style=color:#b06;font-weight:700>baseModel</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#080;font-weight:700>struct</span> <span style=color:#b06;font-weight:700>alpha</span> {
</span></span><span style=display:flex><span>        <span style=color:#080;font-weight:700>static</span> <span style=color:#080;font-weight:700>constexpr</span> <span style=color:#339;font-weight:700>int</span> min_ <span style=color:#333>=</span> <span style=color:#00d;font-weight:700>0</span>;
</span></span><span style=display:flex><span>        <span style=color:#080;font-weight:700>static</span> <span style=color:#080;font-weight:700>constexpr</span> <span style=color:#339;font-weight:700>int</span> max_ <span style=color:#333>=</span> <span style=color:#00d;font-weight:700>10</span>;
</span></span><span style=display:flex><span>        <span style=color:#080;font-weight:700>static</span> <span style=color:#080;font-weight:700>const</span> <span style=color:#339;font-weight:700>int</span> default_ <span style=color:#333>=</span> <span style=color:#00d;font-weight:700>1</span>;
</span></span><span style=display:flex><span>        <span style=color:#080;font-weight:700>static</span> <span style=color:#080;font-weight:700>constexpr</span> std<span style=color:#333>::</span>string_view name_ <span style=color:#333>=</span> <span style=background-color:#fff0f0>&#34;alpha&#34;</span>;
</span></span><span style=display:flex><span>        <span style=color:#080;font-weight:700>static</span> <span style=color:#080;font-weight:700>constexpr</span> std<span style=color:#333>::</span>string_view description_ <span style=color:#333>=</span> <span style=background-color:#fff0f0>&#34;cool description of alpha&#34;</span>;
</span></span><span style=display:flex><span>        <span style=color:#339;font-weight:700>int</span> v;
</span></span><span style=display:flex><span>    } alpha;
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>We could then use <code>alpha.default</code> to initialize <code>alpha</code>; and it is accessible through the reflection system. Since it&rsquo;s a <code>constexpr</code>; this adds no runtime costs. The thing is, the default value for non-linear types will need to be initialized out-of-line. Using the reflection system for default values is possible for literal types only since non-literals cannot generally be <code>constexpr</code> (at the moment, there is no support for <code>constexpr std::vector</code> in any compiler!).</p><h3 id=complete-nested-model-schemas>Complete nested model schemas???</h3><p>If we look closely at the generated schema from the previous example:</p><pre tabindex=0><code>{
    baseModelType   childModel;
    type            ;
    subModel
    {
        baseModelType   &#34;__one of ( childModel childModel1 childModel2 )__&#34;;
        key             &#34;__optional Foam::word here__&#34;;
        m               0;
        vv              ( 0 0 0 );
    }
    key             &#34;__optional Foam::word here__&#34;;
    m               0;
    vv              ( 0 0 0 );
}
</code></pre><p>we can see that the <code>subModel</code> shows only members of the base class. To make it show the full array of members of the concrete type, the user can be prompted to pick a valid model, and then <code>baseModel::schema("pickedModel")</code> will be called inside <code>builder::schema&lt;baseModel>()</code> instead of calling <code>builder::schema&lt;memberBaseType>()</code>. This scenario is particularly useful in building GUIs.</p><h2 id=conclusion>Conclusion</h2><p>At this point, all of the design goals mentioned back in <a href=/blog/2023/09/29/a-reflection-system-for-meshfreefoam-part-1/>Part 1</a> have been achieved. Except for minor changes, I will not develop the system any further.</p><p>Use cases are exclusively <strong>(automatically) generating schemas for OpenFOAM classes</strong> and <strong>(again automatically) building GUI widgets for target types</strong></p><p>You can find the final product with a sample application to iteratively generate a dictionary for some basic models at <a href=https://github.com/FoamScience/openfoam-reflections>FoamScience/openfoam-reflections</a>.</p><ul class="list-unstyled d-flex justify-content-between align-items-center mb-0 pt-5"><li><a class="btn btn-primary disabled"><span class=me-1>←</span>Previous</a></li><li><a href=/MeshFreeFoam-Docs/blog/2023/10/02/a-reflection-system-for-meshfreefoam-part-2/ aria-label="Next - A reflection system for MeshFreeFoam: Part 2" class="btn btn-primary">Next<span class=ms-1>→</span></a></li></ul></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title="Discord server" aria-label="Discord server"><a target=_blank rel=noopener href=https://discord/invitation/link aria-label="Discord server"><i class="fab fa-discord"></i></a></li></ul></div><div class="col-6 col-sm-4 text-end text-xs-center order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/FoamScience/MeshFreeFoam aria-label=GitHub><i class="fab fa-github"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Slack aria-label=Slack><a target=_blank rel=noopener href=https://example.org/slack aria-label=Slack><i class="fab fa-slack"></i></a></li></ul></div><div class="td-footer__copyright-etc col-12 col-sm-4 text-center py-2 order-sm-2"><span>&copy; 2024 Mohammed Elwardi Fadeli All Rights Reserved</span>
<span class=ms-1><a href=https://policies.google.com/privacy target=_blank rel=noopener>Privacy Policy</a></span><p class="td-footer__about mt-2"><a href=/MeshFreeFoam-Docs/about/>About APIDocs</a></p></div></div></div></footer></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css integrity="sha512-mQwom8Ns4op+H29oDkD/LXO/OsXPvCFfkgZkFAVrhhePzRLU8NUI3Nkm43NhWUSmj3p5Cca2HTEkMQmXQRwDQQ==" crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.js integrity="sha512-sHSNLECRJSK+BFs7E8DiFc6pf6n90bLI85Emiw1jhreduZhK3VXgq9l4kAt9eTIHYAcuQBKHL01QKs4/3Xgl8g==" crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/contrib/auto-render.min.js integrity="sha512-iWiuBS5nt6r60fCz26Nd0Zqe0nbk1ZTIQbl3Kv7kYsX+yKMUFHzjaH2+AnM6vp2Xs+gNmaBAVWJjSmuPw76Efg==" crossorigin=anonymous onload='renderMathInElement(document.body,{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"},{display:!0,left:"\\[",right:"\\]"}],errorcolor:"#CD5C5C",throwonerror:!0})'></script><script src=/MeshFreeFoam-Docs/js/main.min.99abe30f7fb05785a480d405ee1665ebd520cec6bbadffe966b7737e103675b8.js integrity="sha256-mavjD3+wV4WkgNQF7hZl69Ugzsa7rf/pZrdzfhA2dbg=" crossorigin=anonymous></script>
<script src=/MeshFreeFoam-Docs/js/prism.js></script>
<script src=/MeshFreeFoam-Docs/js/tabpane-persist.js></script></body></html>